<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBD Errors Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000000);
        }

        .header p {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999999);
        }

        .step {
            display: none;
            margin-bottom: 20px;
        }

        .step.active {
            display: block;
        }

        .step-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--tg-theme-text-color, #000000);
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--tg-theme-text-color, #000000);
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #0088cc);
            box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.2);
        }

        .button {
            width: 100%;
            padding: 12px 16px;
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .button:hover {
            background: var(--tg-theme-button-color, #006699);
        }

        .button:disabled {
            background: var(--tg-theme-hint-color, #cccccc);
            cursor: not-allowed;
        }

        .button-secondary {
            background: transparent;
            color: var(--tg-theme-button-color, #0088cc);
            border: 1px solid var(--tg-theme-button-color, #0088cc);
        }

        .button-secondary:hover {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .marks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .mark-button {
            padding: 12px;
            background: var(--tg-theme-bg-color, #ffffff);
            border: 1px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            color: var(--tg-theme-text-color, #000000);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .mark-button:hover {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .models-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--tg-theme-hint-color, #cccccc);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .model-item {
            padding: 12px;
            border-bottom: 1px solid var(--tg-theme-hint-color, #cccccc);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .model-item:hover {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .model-item:last-child {
            border-bottom: none;
        }

        .generations-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .generation-button {
            padding: 12px;
            background: var(--tg-theme-bg-color, #ffffff);
            border: 1px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            color: var(--tg-theme-text-color, #000000);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .generation-button:hover {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--tg-theme-hint-color, #cccccc);
            border-top: 4px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 16px;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 8px;
        }

        .loading-subtext {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999999);
        }

        .result {
            background: var(--tg-theme-bg-color, #ffffff);
            border: 1px solid var(--tg-theme-hint-color, #cccccc);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .result-icon {
            font-size: 24px;
            margin-right: 8px;
        }

        .result-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
        }

        .result-car {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999999);
            margin-bottom: 12px;
        }

        .result-error-code {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 12px;
            display: inline-block;
        }

        .result-description {
            font-size: 14px;
            line-height: 1.5;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 12px;
        }

        .result-recommendations {
            background: var(--tg-theme-hint-color, #f0f0f0);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .result-recommendations h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000000);
        }

        .result-recommendations ul {
            font-size: 13px;
            line-height: 1.4;
            color: var(--tg-theme-text-color, #000000);
        }

        .back-button {
            margin-bottom: 16px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #ffcdd2;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #c8e6c9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó OBD Errors</h1>
            <p>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</p>
        </div>

        <!-- –®–∞–≥ 1: –í–≤–æ–¥ –∫–æ–¥–∞ –æ—à–∏–±–∫–∏ -->
        <div class="step active" id="step1">
            <div class="step-title">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –æ—à–∏–±–∫–∏ OBD-II</div>
            <div class="input-group">
                <label for="errorCode">–ö–æ–¥ –æ—à–∏–±–∫–∏:</label>
                <input type="text" id="errorCode" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: P0301, C1234, U1000" maxlength="6">
            </div>
            <button class="button" onclick="validateErrorCode()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>

        <!-- –®–∞–≥ 2: –í—ã–±–æ—Ä –º–∞—Ä–∫–∏ -->
        <div class="step" id="step2">
            <div class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è</div>
            <div class="marks-grid" id="marksGrid">
                <!-- –ú–∞—Ä–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <button class="button button-secondary" onclick="showAllMarks()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–∞—Ä–∫–∏</button>
            <button class="button button-secondary back-button" onclick="goBack(1)">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –®–∞–≥ 3: –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ -->
        <div class="step" id="step3">
            <div class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è</div>
            <div class="models-list" id="modelsList">
                <!-- –ú–æ–¥–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <button class="button button-secondary back-button" onclick="goBack(2)">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –®–∞–≥ 4: –í—ã–±–æ—Ä –ø–æ–∫–æ–ª–µ–Ω–∏—è -->
        <div class="step" id="step4">
            <div class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ (–≥–æ–¥ –≤—ã–ø—É—Å–∫–∞)</div>
            <div class="generations-list" id="generationsList">
                <!-- –ü–æ–∫–æ–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <button class="button button-secondary back-button" onclick="goBack(3)">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –®–∞–≥ 5: –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div class="step" id="step5">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...</div>
                <div class="loading-subtext">
                    <div>üîç –ö–æ–¥ –æ—à–∏–±–∫–∏: <span id="loadingErrorCode"></span></div>
                    <div>üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å: <span id="loadingCarInfo"></span></div>
                    <div>üì° –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç API...</div>
                    <div>ü§ñ –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏ —Å —É—á–µ—Ç–æ–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—è...</div>
                    <div>üìã –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π...</div>
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 6: –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div class="step" id="step6">
            <div class="result" id="resultContainer">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <button class="button" onclick="startNewDiagnostic()">–ù–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentStep = 1;
        let errorCode = '';
        let selectedMark = null;
        let selectedModel = null;
        let selectedGeneration = null;

        // –î–∞–Ω–Ω—ã–µ –º–∞—Ä–æ–∫ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        const popularMarks = [
            { id: 'BMW', name: 'BMW', cyrillic: '–ë–ú–í' },
            { id: 'MERCEDES', name: 'Mercedes', cyrillic: '–ú–µ—Ä—Å–µ–¥–µ—Å' },
            { id: 'AUDI', name: 'Audi', cyrillic: '–ê—É–¥–∏' },
            { id: 'VOLKSWAGEN', name: 'Volkswagen', cyrillic: '–§–æ–ª—å–∫—Å–≤–∞–≥–µ–Ω' },
            { id: 'TOYOTA', name: 'Toyota', cyrillic: '–¢–æ–π–æ—Ç–∞' },
            { id: 'HONDA', name: 'Honda', cyrillic: '–•–æ–Ω–¥–∞' },
            { id: 'HYUNDAI', name: 'Hyundai', cyrillic: '–•–µ–Ω–¥–∞–π' },
            { id: 'KIA', name: 'Kia', cyrillic: '–ö–∏–∞' },
            { id: 'FORD', name: 'Ford', cyrillic: '–§–æ—Ä–¥' },
            { id: 'CHEVROLET', name: 'Chevrolet', cyrillic: '–®–µ–≤—Ä–æ–ª–µ' },
            { id: 'OPEL', name: 'Opel', cyrillic: '–û–ø–µ–ª—å' },
            { id: 'RENAULT', name: 'Renault', cyrillic: '–†–µ–Ω–æ' },
            { id: 'PEUGEOT', name: 'Peugeot', cyrillic: '–ü–µ–∂–æ' },
            { id: 'CITROEN', name: 'Citroen', cyrillic: '–°–∏—Ç—Ä–æ–µ–Ω' },
            { id: 'SKODA', name: 'Skoda', cyrillic: '–®–∫–æ–¥–∞' },
            { id: 'SEAT', name: 'Seat', cyrillic: '–°–µ–∞—Ç' },
            { id: 'NISSAN', name: 'Nissan', cyrillic: '–ù–∏—Å—Å–∞–Ω' },
            { id: 'MAZDA', name: 'Mazda', cyrillic: '–ú–∞–∑–¥–∞' },
            { id: 'MITSUBISHI', name: 'Mitsubishi', cyrillic: '–ú–∏—Ü—É–±–∏—Å–∏' },
            { id: 'SUBARU', name: 'Subaru', cyrillic: '–°—É–±–∞—Ä—É' }
        ];

        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–¥–∞ –æ—à–∏–±–∫–∏
        function validateErrorCode() {
            const errorCodeInput = document.getElementById('errorCode');
            const code = errorCodeInput.value.trim().toUpperCase();
            
            if (!code) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –æ—à–∏–±–∫–∏');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–¥–∞ –æ—à–∏–±–∫–∏
            if (!isValidErrorCode(code)) {
                showError('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–¥–∞ –æ—à–∏–±–∫–∏. –ü—Ä–∏–º–µ—Ä—ã: P0301, C1234, U1000');
                return;
            }

            errorCode = code;
            loadMarks();
            showStep(2);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–¥–∞ –æ—à–∏–±–∫–∏
        function isValidErrorCode(code) {
            if (code.length < 4 || code.length > 6) return false;
            if (!['P', 'C', 'B', 'U'].includes(code[0])) return false;
            return /^\d+$/.test(code.substring(1));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä–æ–∫
        function loadMarks() {
            const marksGrid = document.getElementById('marksGrid');
            marksGrid.innerHTML = '';

            popularMarks.forEach(mark => {
                const button = document.createElement('button');
                button.className = 'mark-button';
                button.textContent = `${mark.name} (${mark.cyrillic})`;
                button.onclick = () => selectMark(mark);
                marksGrid.appendChild(button);
            });
        }

        // –í—ã–±–æ—Ä –º–∞—Ä–∫–∏
        function selectMark(mark) {
            selectedMark = mark;
            loadModels(mark.id);
            showStep(3);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π
        function loadModels(markId) {
            const modelsList = document.getElementById('modelsList');
            modelsList.innerHTML = '';

            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ - API –∑–∞–ø—Ä–æ—Å)
            const models = getModelsForMark(markId);
            
            models.forEach(model => {
                const item = document.createElement('div');
                item.className = 'model-item';
                item.textContent = `${model.name} (${model.cyrillic})`;
                item.onclick = () => selectModel(model);
                modelsList.appendChild(item);
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–ª—è –º–∞—Ä–∫–∏ (–∑–∞–≥–ª—É—à–∫–∞)
        function getModelsForMark(markId) {
            const modelsMap = {
                'BMW': [
                    { id: '3-series', name: '3 Series', cyrillic: '3 —Å–µ—Ä–∏—è' },
                    { id: '5-series', name: '5 Series', cyrillic: '5 —Å–µ—Ä–∏—è' },
                    { id: 'x3', name: 'X3', cyrillic: '–•3' },
                    { id: 'x5', name: 'X5', cyrillic: '–•5' }
                ],
                'MERCEDES': [
                    { id: 'c-class', name: 'C-Class', cyrillic: '–°-–∫–ª–∞—Å—Å' },
                    { id: 'e-class', name: 'E-Class', cyrillic: '–ï-–∫–ª–∞—Å—Å' },
                    { id: 's-class', name: 'S-Class', cyrillic: '–°-–∫–ª–∞—Å—Å' },
                    { id: 'gla', name: 'GLA', cyrillic: '–ì–õ–ê' }
                ],
                'AUDI': [
                    { id: 'a3', name: 'A3', cyrillic: '–ê3' },
                    { id: 'a4', name: 'A4', cyrillic: '–ê4' },
                    { id: 'a6', name: 'A6', cyrillic: '–ê6' },
                    { id: 'q3', name: 'Q3', cyrillic: '–ö3' }
                ]
            };

            return modelsMap[markId] || [
                { id: 'default', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –º–æ–¥–µ–ª—å', cyrillic: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –º–æ–¥–µ–ª—å' }
            ];
        }

        // –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
        function selectModel(model) {
            selectedModel = model;
            loadGenerations();
            showStep(4);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∫–æ–ª–µ–Ω–∏–π
        function loadGenerations() {
            const generationsList = document.getElementById('generationsList');
            generationsList.innerHTML = '';

            const generations = [
                { id: '2020-2024', name: '2020-2024' },
                { id: '2015-2019', name: '2015-2019' },
                { id: '2010-2014', name: '2010-2014' },
                { id: '2005-2009', name: '2005-2009' },
                { id: '2000-2004', name: '2000-2004' },
                { id: '1995-1999', name: '1995-1999' }
            ];

            generations.forEach(gen => {
                const button = document.createElement('button');
                button.className = 'generation-button';
                button.textContent = gen.name;
                button.onclick = () => selectGeneration(gen);
                generationsList.appendChild(button);
            });
        }

        // –í—ã–±–æ—Ä –ø–æ–∫–æ–ª–µ–Ω–∏—è
        function selectGeneration(generation) {
            selectedGeneration = generation;
            showLoading();
            showStep(5);
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ - API –∑–∞–ø—Ä–æ—Å)
            setTimeout(() => {
                getErrorDescription();
            }, 3000);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
        function showLoading() {
            document.getElementById('loadingErrorCode').textContent = errorCode;
            document.getElementById('loadingCarInfo').textContent = 
                `${selectedMark.name} ${selectedModel.name} ${selectedGeneration.name}`;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –æ—à–∏–±–∫–∏
        function getErrorDescription() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å
            const description = generateErrorDescription();
            showResult(description);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –æ—à–∏–±–∫–∏ (–∑–∞–≥–ª—É—à–∫–∞)
        function generateErrorDescription() {
            const descriptions = {
                'P0301': {
                    title: '–ü—Ä–æ–ø—É—Å–∫ –∑–∞–∂–∏–≥–∞–Ω–∏—è –≤ —Ü–∏–ª–∏–Ω–¥—Ä–µ 1',
                    description: '–î–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–∂–∏–≥–∞–Ω–∏–µ–º –≤ –ø–µ—Ä–≤–æ–º —Ü–∏–ª–∏–Ω–¥—Ä–µ –¥–≤–∏–≥–∞—Ç–µ–ª—è. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–æ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å—é —Å–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è, –∫–∞—Ç—É—à–∫–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è, —Ç–æ–ø–ª–∏–≤–Ω–æ–π —Ñ–æ—Ä—Å—É–Ω–∫–∏ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å –∫–æ–º–ø—Ä–µ—Å—Å–∏–µ–π.',
                    recommendations: [
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è –≤ —Ü–∏–ª–∏–Ω–¥—Ä–µ 1',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—Ç—É—à–∫—É –∑–∞–∂–∏–≥–∞–Ω–∏—è',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–ø–ª–∏–≤–Ω—É—é —Ñ–æ—Ä—Å—É–Ω–∫—É',
                        '–ò–∑–º–µ—Ä—å—Ç–µ –∫–æ–º–ø—Ä–µ—Å—Å–∏—é –≤ —Ü–∏–ª–∏–Ω–¥—Ä–µ'
                    ],
                    severity: '—Å—Ä–µ–¥–Ω—è—è'
                },
                'P0171': {
                    title: '–°–ª–∏—à–∫–æ–º –±–µ–¥–Ω–∞—è —Å–º–µ—Å—å',
                    description: '–û—à–∏–±–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ —Ç–æ–ø–ª–∏–≤–Ω–æ-–≤–æ–∑–¥—É—à–Ω–∞—è —Å–º–µ—Å—å —Å–ª–∏—à–∫–æ–º –±–µ–¥–Ω–∞—è. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–æ —É—Ç–µ—á–∫–æ–π –≤–æ–∑–¥—É—Ö–∞, –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å—é –¥–∞—Ç—á–∏–∫–∞ –∫–∏—Å–ª–æ—Ä–æ–¥–∞ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å —Ç–æ–ø–ª–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π.',
                    recommendations: [
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—å –≤–ø—É—Å–∫–Ω–æ–≥–æ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—á–∏–∫ –º–∞—Å—Å–æ–≤–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞ –≤–æ–∑–¥—É—Ö–∞',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—á–∏–∫ –∫–∏—Å–ª–æ—Ä–æ–¥–∞',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–ª–∏–≤–∞'
                    ],
                    severity: '—Å—Ä–µ–¥–Ω—è—è'
                },
                'C1234': {
                    title: '–û—à–∏–±–∫–∞ ABS',
                    description: '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ ABS. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å—é –¥–∞—Ç—á–∏–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–æ–ª–µ—Å–∞, –º–æ–¥—É–ª—è ABS –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å –ø—Ä–æ–≤–æ–¥–∫–æ–π.',
                    recommendations: [
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—á–∏–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–æ–ª–µ—Å',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥—É–ª—å ABS',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–≤–æ–¥–∫—É —Å–∏—Å—Ç–µ–º—ã ABS',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Ç–æ—Ä–º–æ–∑–Ω–æ–π –∂–∏–¥–∫–æ—Å—Ç–∏'
                    ],
                    severity: '–≤—ã—Å–æ–∫–∞—è'
                }
            };

            return descriptions[errorCode] || {
                title: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',
                description: '–î–∞–Ω–Ω—ã–π –∫–æ–¥ –æ—à–∏–±–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.',
                recommendations: [
                    '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏',
                    '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∞–≤—Ç–æ–º–æ–±–∏–ª—è',
                    '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–∫–∞–Ω–µ—Ä'
                ],
                severity: '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'
            };
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function showResult(data) {
            const resultContainer = document.getElementById('resultContainer');
            resultContainer.innerHTML = `
                <div class="result-header">
                    <div class="result-icon">üîç</div>
                    <div class="result-title">${data.title}</div>
                </div>
                <div class="result-car">
                    üöó ${selectedMark.name} ${selectedModel.name} ${selectedGeneration.name}
                </div>
                <div class="result-error-code">${errorCode}</div>
                <div class="result-description">${data.description}</div>
                <div class="result-recommendations">
                    <h4>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
                    <ul>
                        ${data.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                <div style="font-size: 12px; color: var(--tg-theme-hint-color, #999999);">
                    ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ${data.severity}
                </div>
            `;
            
            showStep(6);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–∞—Ä–∫–∏
        function showAllMarks() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –º–∞—Ä–æ–∫
            showError('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É
        function showStep(step) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —à–∞–≥–∏
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π —à–∞–≥
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
        }

        // –ù–∞–∑–∞–¥
        function goBack(step) {
            showStep(step);
        }

        // –ù–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        function startNewDiagnostic() {
            // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
            errorCode = '';
            selectedMark = null;
            selectedModel = null;
            selectedGeneration = null;
            
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
            document.getElementById('errorCode').value = '';
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø–µ—Ä–≤–æ–º—É —à–∞–≥—É
            showStep(1);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(errorDiv, container.firstChild);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(successDiv, container.firstChild);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        document.getElementById('errorCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                validateErrorCode();
            }
        });
    </script>
</body>
</html>